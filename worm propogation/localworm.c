#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/wait.h>
#define simulN   3
#define simulTime  1400
#define address_space     100000

enum nodeMode {empty,susceptible,infected};

//Generates a random value between 0 and 1.
double rand_gen(){
	double rand_num;
	rand_num = ( rand()+0.5 ) / ((RAND_MAX) + 1.0);
	return rand_num;
}

int main(void)
{
	int random_seed,sim,i,tick,j,k,min,max,m;
	int scan_rate=2;
	int It[simulN][simulTime];
	FILE *fp;
	int infected_ip,prev_infected_ip;
	enum nodeMode nodestatus[address_space+1],priornodestatus[address_space+1];
	for(sim=0;sim<3;sim++)
	{
		tick=0;
		infected_ip=1;
		for(i=1;i<=address_space;i++){
		nodestatus[i]=empty;
		}
		for(j=0;j<100;j++){
		for(i=1;i<=10;i++){
		nodestatus[i+j*1000]=susceptible;
		}
		}
    	random_seed=rand()%100000+1;
		nodestatus[1]=infected;
		for(i=0;i<address_space+1;i++){
		priornodestatus[i]=nodestatus[i];
		}
		prev_infected_ip=infected_ip;
		while(tick<simulTime)
		{
			for(k=1;k<=address_space;k++)
			{
			if(priornodestatus[k]==infected)
			{
				if(rand_gen()<=0.6)
				{
				min=k-10;
				max=k+10;
				for(m=0;m<scan_rate;m++){
					random_seed=min+rand()%(max-min+1);
					if(priornodestatus[random_seed]==susceptible && nodestatus[random_seed]!=infected)
					{
						nodestatus[random_seed]=infected;
						infected_ip++;
					}
				}
				
				}
				else
				{
				for(m=0;m<scan_rate;m++){
					random_seed=rand()%100000+1;
					if(priornodestatus[random_seed]==susceptible && nodestatus[random_seed]!=infected)
					{
						nodestatus[random_seed]=infected;
						infected_ip++;
					}
				
				}
				}
			}
			}
		for(i=0;i<address_space+1;i++){
		priornodestatus[i]=nodestatus[i];
		}
		prev_infected_ip=infected_ip;
		It[sim][tick]=infected_ip;
		tick++;
		}
	}
	fp=fopen("local_pref_out.txt","w");
	for(i=0;i<simulTime;i++)
	{
	for(j=0;j<simulN;j++)
	
		fprintf(fp,"%d\t",It[j][i]);
		fprintf(fp,"\n");
	}
	fclose(fp);
   return 0;
}
